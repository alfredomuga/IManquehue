{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "Data-Factory-BI"
		},
		"imsadatalake_accountKey": {
			"type": "secureString",
			"metadata": "Secure string for 'accountKey' of 'imsadatalake'"
		},
		"DWIM_IMSA_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'DWIM_IMSA'"
		},
		"Publicar OC_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://apimtanner-qa.azure-api.net/enterprise/providers-portal/integration-erp-red-proveedores/api/PurchaseOrder/SavePurchaseOrder"
		},
		"imsadatalake_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://imsadatalake.dfs.core.windows.net/"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/Publicar OC')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"CompanyRut": {
						"type": "string"
					},
					"SupplierRUT": {
						"type": "string"
					},
					"OrderNumber": {
						"type": "string"
					},
					"ReceptionNumber": {
						"type": "string"
					},
					"Amount": {
						"type": "int"
					},
					"DTEType": {
						"type": "int"
					},
					"PayDays": {
						"type": "int"
					},
					"ExternalId": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "RestService",
				"typeProperties": {
					"url": "[parameters('Publicar OC_properties_typeProperties_url')]",
					"enableServerCertificateValidation": true,
					"authenticationType": "Anonymous"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/imsadatalake')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('imsadatalake_properties_typeProperties_url')]",
					"accountKey": {
						"type": "SecureString",
						"value": "[parameters('imsadatalake_accountKey')]"
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DWIM')]",
			"type": "Microsoft.DataFactory/factories/integrationRuntimes",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "SelfHosted",
				"description": "IR de la VM IMSA",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/integrationHana')]",
			"type": "Microsoft.DataFactory/factories/integrationRuntimes",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "SelfHosted",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Budget')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Planificacion"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Budget",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "ControlHitos.xlsx",
						"folderPath": "Automatizaciones/Control de Hitos",
						"fileSystem": "imsa-files"
					},
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/CSV_Datalake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Folder": {
						"type": "string"
					},
					"File": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().File",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Folder",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/CSV_Datalake_Fechas')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"ano": {
						"type": "string"
					},
					"mes": {
						"type": "string"
					},
					"dia": {
						"type": "string"
					},
					"FolderPath": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@concat(dataset().FolderPath,'/',dataset().ano,'/',dataset().mes,'/',dataset().dia)",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DimEscenario')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Dimensiones"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "DimEscenario",
						"folderPath": "Dimensiones",
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "idEscenario",
						"type": "String"
					},
					{
						"name": "Escenario",
						"type": "String"
					},
					{
						"name": "Codigo",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DimHitos')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Dimensiones"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "DimHito",
						"folderPath": "Dimensiones",
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "idHito",
						"type": "String"
					},
					{
						"name": "Hito",
						"type": "String"
					},
					{
						"name": "Codigo",
						"type": "String"
					},
					{
						"name": "Orden",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DimProyectoEtapa')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Dimensiones"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "DimProyectoEta",
						"folderPath": "Dimensiones",
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "idProyectoEtapa",
						"type": "String"
					},
					{
						"name": "Proyecto",
						"type": "String"
					},
					{
						"name": "EtapaComercial",
						"type": "String"
					},
					{
						"name": "EtapaFinanciera",
						"type": "String"
					},
					{
						"name": "Unidades",
						"type": "String"
					},
					{
						"name": "RutEmpresa",
						"type": "String"
					},
					{
						"name": "Segmento",
						"type": "String"
					},
					{
						"name": "ParticipacionSocios",
						"type": "String"
					},
					{
						"name": "Socio",
						"type": "String"
					},
					{
						"name": "Comuna",
						"type": "String"
					},
					{
						"name": "Constructora",
						"type": "String"
					},
					{
						"name": "CostoTotal",
						"type": "String"
					},
					{
						"name": "ValorTerreno",
						"type": "String"
					},
					{
						"name": "LineaConstruccion",
						"type": "String"
					},
					{
						"name": "ProximoHito",
						"type": "String"
					},
					{
						"name": "FechaBudget",
						"type": "String"
					},
					{
						"name": "FechaForecast",
						"type": "String"
					},
					{
						"name": "Variacion",
						"type": "String"
					},
					{
						"name": "EstadoProyecto",
						"type": "String"
					},
					{
						"name": "TipoFinanciamientoSocios",
						"type": "String"
					},
					{
						"name": "VigenciaDeuda",
						"type": "String"
					},
					{
						"name": "TipoActivo",
						"type": "String"
					},
					{
						"name": "EtapaGestion",
						"type": "String"
					},
					{
						"name": "AtrasoMeses",
						"type": "String"
					},
					{
						"name": "EtapaConstructora",
						"type": "String"
					},
					{
						"name": "Codigo",
						"type": "String"
					},
					{
						"name": "Considerar",
						"type": "String"
					},
					{
						"name": "Empresa",
						"type": "String"
					},
					{
						"name": "BancoAlzante",
						"type": "String"
					},
					{
						"name": "IVA",
						"type": "String"
					},
					{
						"name": "IFRS",
						"type": "String"
					},
					{
						"name": "Consolida",
						"type": "String"
					},
					{
						"name": "Act",
						"type": "String"
					},
					{
						"name": "Act_Comercial",
						"type": "String"
					},
					{
						"name": "Act_Masterfechas",
						"type": "String"
					},
					{
						"name": "Act_FlujoCaja",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/EscribirHES')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Publicar OC",
					"type": "LinkedServiceReference",
					"parameters": {
						"PayDays": "Value"
					}
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/Publicar OC')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Area_Empleados_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FolderPath": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					},
					"Sheet": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().FolderPath",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"range": "A5:N1000",
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_CentroCostos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Audatia (Nomina por Peso y PY-C",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "Centro_Costos.xlsx",
						"folderPath": "Modelo RRHH",
						"fileSystem": "imsa-files"
					},
					"range": "A5:F1000",
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"name": "Libro: Audatia (Nomina por Peso y PY-CC)",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Control_Hitos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Sheet": {
						"type": "string"
					},
					"Range": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "ControlHitos.xlsx",
						"folderPath": "Automatizaciones/Control de Hitos",
						"fileSystem": "imsa-files"
					},
					"range": {
						"value": "@dataset().Range",
						"type": "Expression"
					},
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Datalake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Folder": {
						"type": "string"
					},
					"File": {
						"type": "string"
					},
					"Sheet": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().File",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Folder",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Finiquitos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Finiquitos",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "Finiquitos.xlsx",
						"folderPath": "Modelo RRHH",
						"fileSystem": "imsa-files"
					},
					"range": "A4:AM1000",
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"name": "Libro: Finiquitos",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Forecast')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Planificacion"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Forecast",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "ControlHitos.xlsx",
						"folderPath": "Automatizaciones/Control de Hitos",
						"fileSystem": "imsa-files"
					},
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Real')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Planificacion"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Real",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "ControlHitos.xlsx",
						"folderPath": "Automatizaciones/Control de Hitos",
						"fileSystem": "imsa-files"
					},
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"name": "Proyecto",
						"type": "String"
					},
					{
						"name": "Etapa",
						"type": "String"
					},
					{
						"name": "Hito",
						"type": "String"
					},
					{
						"name": "Mes",
						"type": "String"
					},
					{
						"name": "Año",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/dboFecha')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/Dimensiones"
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "dbofecha",
						"folderPath": "Dimensiones",
						"fileSystem": "imsa-files"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"name": "idFecha",
						"type": "String"
					},
					{
						"name": "Anho",
						"type": "String"
					},
					{
						"name": "NumeroMesCero",
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/imsadatalake')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DWIM_IMSA')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('DWIM_IMSA_connectionString')]"
				},
				"connectVia": {
					"referenceName": "DWIM",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/integrationRuntimes/DWIM')]"
			]
		}
	]
}