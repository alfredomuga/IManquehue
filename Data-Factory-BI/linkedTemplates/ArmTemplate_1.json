{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Nombre de instancia de Data Factory",
			"defaultValue": "Data-Factory-BI"
		},
		"DWIM_IMSA_connectionString": {
			"type": "secureString",
			"metadata": "Cadena protegida para \"connectionString\"de \"DWIM_IMSA\""
		},
		"IMSA_HANA_connectionString": {
			"type": "secureString",
			"metadata": "Cadena protegida para \"connectionString\"de \"IMSA_HANA\""
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/EscribirHES')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "Publicar OC",
					"type": "LinkedServiceReference",
					"parameters": {
						"PayDays": "Value"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "RestResource",
				"typeProperties": {},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Area_Empleados_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"FolderPath": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					},
					"Sheet": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().FolderPath",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"range": "A5:N1000",
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_CentroCostos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Audatia (Nomina por Peso y PY-C",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "Centro_Costos.xlsx",
						"folderPath": "Modelo RRHH",
						"fileSystem": "imsa-files"
					},
					"range": "A5:F1000",
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"name": "Libro: Audatia (Nomina por Peso y PY-CC)",
						"type": "String"
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Control_Hitos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Sheet": {
						"type": "string"
					},
					"Range": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "ControlHitos.xlsx",
						"folderPath": "Automatizaciones/Control de Hitos",
						"fileSystem": "imsa-files"
					},
					"range": {
						"value": "@dataset().Range",
						"type": "Expression"
					},
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Datalake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Folder": {
						"type": "string"
					},
					"File": {
						"type": "string"
					},
					"Sheet": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": {
						"value": "@dataset().Sheet",
						"type": "Expression"
					},
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().File",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().Folder",
							"type": "Expression"
						},
						"fileSystem": "imsa-files"
					},
					"firstRowAsHeader": true
				},
				"schema": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Finiquitos_DataLake')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"sheetName": "Finiquitos",
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "Finiquitos.xlsx",
						"folderPath": "Modelo RRHH",
						"fileSystem": "imsa-files"
					},
					"range": "A4:AM1000",
					"firstRowAsHeader": true
				},
				"schema": [
					{
						"name": "Libro: Finiquitos",
						"type": "String"
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Excel_Flujo_Caja_Inmobiliario')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "Excel",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "BD Hist√≥rica Flujos Caja.xlsx",
						"folderPath": "Modelo Flujo de Caja/Flujo Caja Proyectos Inmobiliarios",
						"fileSystem": "imsa-files"
					},
					"sheetIndex": 0,
					"range": "A2:P1000000",
					"firstRowAsHeader": false
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/FechaFirmaPromesa')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "imsadatalake",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DataLake/PlanOK"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": "FechaFirmaPromesa",
						"folderPath": "PlanOK",
						"fileSystem": "imsa-files"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"id_promesa": {
							"type": "integer"
						},
						"id_negocio": {
							"type": "integer"
						},
						"fecha_firma_comprador": {
							"type": "string"
						},
						"setFechaFirmaComprador": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ThDetalleMovimiento')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM2",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW2/Finanzas"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "TransId",
						"type": "int",
						"precision": 10
					},
					{
						"name": "LineMemo",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "th",
					"table": "DetalleMovimiento"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ThLibroMayor')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM2",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW2/Finanzas"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "tipo",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Account",
						"type": "varchar"
					},
					{
						"name": "FormatCode",
						"type": "varchar"
					},
					{
						"name": "AcctName",
						"type": "varchar"
					},
					{
						"name": "TransId",
						"type": "int",
						"precision": 10
					},
					{
						"name": "RefDate",
						"type": "date"
					},
					{
						"name": "Debit",
						"type": "float",
						"precision": 15
					},
					{
						"name": "Credit",
						"type": "float",
						"precision": 15
					},
					{
						"name": "SYSDebit",
						"type": "float",
						"precision": 15
					},
					{
						"name": "SYSCredit",
						"type": "float",
						"precision": 15
					},
					{
						"name": "LineMemo",
						"type": "varchar"
					},
					{
						"name": "TransType",
						"type": "varchar"
					},
					{
						"name": "Libro",
						"type": "varchar"
					},
					{
						"name": "CodSucursal",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Sucursal",
						"type": "varchar"
					},
					{
						"name": "Fecha_Snapshot",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "th",
					"table": "LibroMayor"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/ThPromesas')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM2",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW2/Backlog"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "fechaPromesa",
						"type": "varchar"
					},
					{
						"name": "totalLista",
						"type": "int",
						"precision": 10
					},
					{
						"name": "descuentoSubtotal.valor",
						"type": "float",
						"precision": 15
					},
					{
						"name": "descuentoSubtotal.unidadad",
						"type": "varchar"
					},
					{
						"name": "totalVenta",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.nombre",
						"type": "varchar"
					},
					{
						"name": "productos.tipo",
						"type": "varchar"
					},
					{
						"name": "productos.precioLista",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.descuento.valor",
						"type": "float",
						"precision": 15
					},
					{
						"name": "productos.descuento.unidad",
						"type": "varchar"
					},
					{
						"name": "productos.precioVenta",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.proyecto.id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.proyecto.nombre",
						"type": "varchar"
					},
					{
						"name": "productos.etapa.id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.etapa.nombre",
						"type": "varchar"
					},
					{
						"name": "productos.subAgrupacion.id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "productos.subAgrupacion.nombre",
						"type": "varchar"
					},
					{
						"name": "cliente.id",
						"type": "int",
						"precision": 10
					},
					{
						"name": "cliente.identificadorPersonal",
						"type": "varchar"
					},
					{
						"name": "cliente.nombre",
						"type": "varchar"
					},
					{
						"name": "cliente.telefono",
						"type": "varchar"
					},
					{
						"name": "cliente.email",
						"type": "varchar"
					},
					{
						"name": "id_promesa",
						"type": "int",
						"precision": 10
					},
					{
						"name": "id_negocio",
						"type": "int",
						"precision": 10
					},
					{
						"name": "fecha_firma_comprador",
						"type": "varchar"
					},
					{
						"name": "setFechaFirmaComprador",
						"type": "varchar"
					},
					{
						"name": "FechaCargaBI",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "th",
					"table": "Promesas"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/sapDeudoresInmobiliarios')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM2",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW2/DeudoresInmobiliarios"
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [
					{
						"name": "idFecha",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idProyectoEtapa",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idEscenario",
						"type": "int",
						"precision": 10
					},
					{
						"name": "CodigoHito",
						"type": "varchar"
					},
					{
						"name": "OrdenHito",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Proyecto",
						"type": "varchar"
					},
					{
						"name": "Etapa",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "sap",
					"table": "DeudoresInmobiliarios"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DWIM_IMSA')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SqlServer",
				"typeProperties": {
					"connectionString": "[parameters('DWIM_IMSA_connectionString')]"
				},
				"connectVia": {
					"referenceName": "DWIM",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/IMSA_HANA')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "SapHana",
				"typeProperties": {
					"connectionString": "[parameters('IMSA_HANA_connectionString')]"
				},
				"connectVia": {
					"referenceName": "integrationHana",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/DWIM')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM_IMSA",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"schema": {
						"type": "string"
					},
					"table": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().schema",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().table",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/DWIM_IMSA')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/HESTanner')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM_IMSA",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [
					{
						"name": "companyRut",
						"type": "nvarchar"
					},
					{
						"name": "supplierRut",
						"type": "nvarchar"
					},
					{
						"name": "orderNumber",
						"type": "nvarchar"
					},
					{
						"name": "receptionNumber",
						"type": "nvarchar"
					},
					{
						"name": "amount",
						"type": "int",
						"precision": 10
					},
					{
						"name": "dteType",
						"type": "int",
						"precision": 10
					},
					{
						"name": "payDays",
						"type": "int",
						"precision": 10
					},
					{
						"name": "externalId",
						"type": "nvarchar"
					}
				],
				"typeProperties": {
					"schema": "dbo",
					"table": "HESTanner"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/DWIM_IMSA')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SAP_HANA')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "IMSA_HANA",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "SapHanaTable",
				"schema": [],
				"typeProperties": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/IMSA_HANA')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/SAP_HANA_Table')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "IMSA_HANA",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"Table_Name": {
						"type": "string"
					}
				},
				"folder": {
					"name": "Otros"
				},
				"annotations": [],
				"type": "SapHanaTable",
				"schema": [],
				"typeProperties": {
					"schema": "SBO_MANQUEHUE",
					"table": {
						"value": "@dataset().Table_Name",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/IMSA_HANA')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ThHitosBudget')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM_IMSA",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW/Planificacion"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [
					{
						"name": "idFecha",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idProyectoEtapa",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idEscenario",
						"type": "int",
						"precision": 10
					},
					{
						"name": "CodigoHito",
						"type": "varchar"
					},
					{
						"name": "OrdenHito",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Proyecto",
						"type": "varchar"
					},
					{
						"name": "Etapa",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "th",
					"table": "HitosBudget"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/DWIM_IMSA')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/ThHitosForescast')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "DWIM_IMSA",
					"type": "LinkedServiceReference"
				},
				"folder": {
					"name": "DW/Planificacion"
				},
				"annotations": [],
				"type": "SqlServerTable",
				"schema": [
					{
						"name": "idFecha",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idProyectoEtapa",
						"type": "int",
						"precision": 10
					},
					{
						"name": "idEscenario",
						"type": "int",
						"precision": 10
					},
					{
						"name": "CodigoHito",
						"type": "varchar"
					},
					{
						"name": "OrdenHito",
						"type": "int",
						"precision": 10
					},
					{
						"name": "Proyecto",
						"type": "varchar"
					},
					{
						"name": "Etapa",
						"type": "varchar"
					}
				],
				"typeProperties": {
					"schema": "th",
					"table": "HitosForecast"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/DWIM_IMSA')]"
			]
		}
	]
}